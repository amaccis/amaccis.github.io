<!doctype html><html lang=en><head><title>TAI and PHP | amaccis.blog</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The first time I&rsquo;ve dealt with TAI (Temps Atomique International/International Atomic Time) was a few years ago, when I was looking for a &ldquo;disappeared&rdquo; email through qmail logs. My first reaction was like: these guys (the ones who set up the logs like that) are nuts!
Don&rsquo;t get me wrong, TAI is awesome as means of time-keeping, because it is extremely precise (atomic clocks deviate only 1 second in up to 100 million years) and we can also consider it very nerdy, just think that one TAI second is defined as the duration of 9."><meta name=generator content="Hugo 0.110.0"><meta name=ROBOTS content="INDEX, FOLLOW"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon><script async src="https://www.googletagmanager.com/gtag/js?id=G-4S09KRTL53"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4S09KRTL53",{anonymize_ip:!1})}</script></head><body><nav class=navigation><a href=/><span class=arrow>←</span>Home</a>
<a href=/posts>Archive</a>
<a href=/tags>Tags</a>
<a href=/about>About</a></nav><main class=main><section id=single><h1 class=title>TAI and PHP</h1><div class=tip><time datetime="2023-03-23 00:00:00 +0000 UTC">Mar 23, 2023</time>
<span class=split>·</span>
<span>1595 words</span>
<span class=split>·</span>
<span>8 minute read</span></div><div class=content><p>The first time I&rsquo;ve dealt with <a href=https://en.wikipedia.org/wiki/International_Atomic_Time target=_blank rel=noopener><strong>TAI</strong></a> (<em>Temps Atomique International/International Atomic Time</em>) was a few years ago,
when I was looking for a &ldquo;disappeared&rdquo; email through qmail logs. My first reaction was like: these guys (the ones who set up the logs like that) are nuts!</p><p>Don&rsquo;t get me wrong, TAI is awesome as means of time-keeping, because it is extremely precise
(<a href=https://www.timeanddate.com/time/how-do-atomic-clocks-work.html target=_blank rel=noopener>atomic clocks deviate only 1 second in up to 100 million years</a>) and we can also consider it very nerdy, just
think that one TAI second is defined as the duration of 9.192.631.770 periods of the radiation corresponding to the transition between the two hyperfine levels of the ground
state of the cesium atom (or, if it&rsquo;s clearer, the time it takes a cesium-133 atom at the ground state to oscillate exactly 9.192.631.770 times). So, so far so good, but
when you are used to deal with standard looking log files, and you see something like that</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>@4000000052a82012173eb0f4 new msg <span style=color:#ae81ff>4242424242</span>
</span></span><span style=display:flex><span>@4000000052a82012173f02fc info msg 4242424242: bytes <span style=color:#ae81ff>12834</span> from &lt;ford.prefect@betelgeuse-v.universe&gt; qp <span style=color:#ae81ff>17478</span> uid <span style=color:#ae81ff>42</span>
</span></span><span style=display:flex><span>@4000000052a82012173f2a0c starting delivery 1056684: msg <span style=color:#ae81ff>4242424242</span> to local arthur.dent@earth.universe
</span></span><span style=display:flex><span>@4000000052a820121825d0ec delivery 1067852: success: did_1+0+0/
</span></span><span style=display:flex><span>@4000000052a82012193141c4 status: local 0/10 remote 0/40
</span></span><span style=display:flex><span>@4000000052a820121931e1ec end msg <span style=color:#ae81ff>4242424242</span>
</span></span></code></pre></div><p>you can only ask yourself: what?</p><p>At that time, since I thought I could need to handle that kind of time format with automated scripts or a web application, I wrote a <strong>PHP</strong> library called
<a href=https://github.com/amaccis/tai64-datetime target=_blank rel=noopener>tai64-datetime</a>.
The idea was extending the PHP <a href=https://www.php.net/manual/en/class.datetime.php target=_blank rel=noopener><code>DateTime</code> class</a> with a new simple feature that could convert <strong><a href=https://en.wikipedia.org/wiki/Coordinated_Universal_Time target=_blank rel=noopener>UTC</a></strong> into TAI
and vice versa. The library turned out to be very bad (poorly thought and written) and at the end of the day fortunately I did not need it, so it remained unused for years.</p><p>A few weeks ago I thought to refactor the code, but, reviewing it I recalled what kind of stupid things I wrote, so I decided to abandon the old library and write a new one.
Not that now I&rsquo;m capable of doing wonders, but I thought it was funny because of the chance to play a bit with the new features of PHP (especially
<a href=https://www.php.net/manual/en/language.types.enumerations.php target=_blank rel=noopener>Enums</a>) and GitHub Actions. And mostly, thinking I was funny too, I decided to call the new library DateTai!
You know, sounds similar to DateTime but with TAI&mldr;</p><p>Joking aside, the new library forced me to address a few interesting topics, also because, before starting, I needed to brush up on
<a href=http://cr.yp.to/libtai/tai64.html target=_blank rel=noopener>a few key concepts</a>.</p><p>A <em>TAI64 label</em> is an integer between 0 and 2^64 referring to a particular second of real time. This integer, let&rsquo;s call it <em>s</em>, refers to:</p><ul><li>the TAI second beginning 2^62 - <em>s</em> seconds before the beginning of 1970 TAI, if 0 ≤ <em>s</em> &lt; 2^62;</li><li>the TAI second beginning <em>s</em> - 2^62 seconds after the beginning of 1970 TAI, if 2^62 ≤ <em>s</em> &lt; 2^63.</li></ul><p>It seems that the integers lesser than 2^63 are enough to cover the entire expected lifetime of the universe, but if you have higher expectations, know that integers ≥ 2^63 are
reserved for future extensions.</p><p>TAI64 labels are normally stored or communicated using the <em>external TAI64 format</em>, consisting of eight 8-bit bytes in big-endian format. For example, bytes
40 00 00 00 00 00 00 00 hexadecimal represent the second that began 1970 TAI.</p><p>Continuing, a <em>TAI64N label</em> refers to a particular nanosecond of real time. It has two parts:</p><ul><li>a TAI64 label;</li><li>an integer, between 0 and 999.999.999 counting nanoseconds from the beginning of the second represented by the TAI64 label.</li></ul><p>A TAI64N label is normally stored or communicated using the <em>external TAI64N format</em>, consisting of twelve 8-bit bytes. The first eight bytes are the TAI64 label in external
TAI64 format. The last four bytes are the nanosecond counter in big-endian format.</p><p>And finally, a <em>TAI64NA label</em> refers to a particular attosecond of real time. It has two parts:</p><ul><li>a TAI64N label;</li><li>an integer, between 0 and 999999999, counting attoseconds from the beginning of the nanosecond represented by the TAI64N label.</li></ul><p>A TAI64NA label is normally stored or communicated using the <em>external TAI64NA format</em>, consisting of sixteen 8-bit bytes. The first twelve bytes are the TAI64N label in external
TAI64N format. The last four bytes are the attosecond counter in big-endian format.</p><p>So putting aside the Pig Latin, basically, how does this stuff work? Let&rsquo;s check the first TAI64 format example, 40 00 00 00 00 00 00 00, that represents the second that began
1970 TAI.</p><p>If we isolate the bytes</p><pre tabindex=0><code>| 40 | 00 | 00 | 00 | 00 | 00 | 00 | 00 |
| b0 | b1 | b2 | b3 | b4 | b5 | b6 | b7 |
</code></pre><p>and we start counting them from the left, because we said it&rsquo;s <a href=https://en.wikipedia.org/wiki/Endianness target=_blank rel=noopener>big-endian format</a>, we apply</p><pre tabindex=0><code>b0*2^56 + b1*2^48 + b2*2^40 + b3*2^32 + b4*2^24 + b5*2^16 + b6*2^8 + b7
</code></pre><p>and in our case, since the decimal value of the hexadecimal <em>40</em> is 64, we have</p><pre tabindex=0><code>64*2^56 + 0*2^48 + 0*2^40 + 0*2^32 + 0*2^24 + 0*2^16 + 0*2^8 + 0 = 4611686018427387904
</code></pre><p>and <em>4.611.686.018.427.387.904</em> is exactly 2^62. So 2^62 - s = 0 and here we are with the second that began 1970 TAI. Quite simple.</p><p>Anyway, nothing to be worried about though, because PHP does the job for us through <code>hexdec()</code>.</p><p>So, to recap what we know:</p><ul><li>0 &lt; <em>s</em> &lt; 2^64</li><li>TAI second = 2^62 - <em>s</em> seconds before the beginning of 1970 TAI, if 0 ≤ <em>s</em> &lt; 2^62;</li><li>TAI second = <em>s</em> - 2^62 seconds after the beginning of 1970 TAI, if 2^62 ≤ <em>s</em> &lt; 2^63.</li></ul><p>in order to compute TAI seconds, we could write something like this</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>TAI64_LABEL_MINIMUM_VALUE</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>TAI_SECOND_EPOCH</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>62</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>TAI64_LABEL_MAXIMUM_VALUE</span> <span style=color:#f92672>=</span> (<span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>63</span>)<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>externalTai64FormatToTaiSecond</span>(<span style=color:#a6e22e>string</span> $tai64Label)<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $second <span style=color:#f92672>=</span> <span style=color:#a6e22e>intval</span>(<span style=color:#a6e22e>hexdec</span>($tai64Label));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($second <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>TAI64_LABEL_MINIMUM_VALUE</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidArgumentException</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>elseif</span> ($second <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>TAI_SECOND_EPOCH</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>string</span>) <span style=color:#f92672>-</span>(<span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>TAI_SECOND_EPOCH</span> <span style=color:#f92672>-</span> $second);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>elseif</span> ($second <span style=color:#f92672>&lt;=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>TAI64_LABEL_MAXIMUM_VALUE</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>string</span>) ($second <span style=color:#f92672>-</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>TAI_SECOND_EPOCH</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>InvalidArgumentException</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>But, let&rsquo;s focus on the edge cases.</p><p>We know that PHP&rsquo;s int type is signed, but <a href=https://www.php.net/manual/en/function.dechex.php target=_blank rel=noopener><code>hexdec()</code> and <code>dechex()</code> (its opposite) deal both with unsigned integers</a>, so
negative integers will be treated as though they were unsigned, meaning that we can not expect a result below zero by <code>intval(hexdec($tai64Label))</code>.</p><p>In addition, we know that the maximum value for an integer in a 64-bit architecture is 2^63 - 1, it is no coincidence that is the exact value of <code>PHP_INT_MAX</code>.
We would need to use things like <code>ext-bcmath</code> in order to handle (as a string) the result of the operation <code>(2**63)-1</code> that, for the purpose of the library, would be pointless,
since we only need to check if the value of <em>s</em> is greater than or equal to 2^62.</p><p>So we can rewrite the code above, this way</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>TAI_SECOND_EPOCH</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span><span style=color:#f92672>**</span><span style=color:#ae81ff>62</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>externalTai64FormatToTaiSecond</span>(<span style=color:#a6e22e>string</span> $tai64Label)<span style=color:#f92672>:</span> <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $second <span style=color:#f92672>=</span> <span style=color:#a6e22e>intval</span>(<span style=color:#a6e22e>hexdec</span>($tai64Label));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($second <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>TAI_SECOND_EPOCH</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>string</span>) <span style=color:#f92672>-</span>(<span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>TAI_SECOND_EPOCH</span> <span style=color:#f92672>-</span> $second);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> (<span style=color:#a6e22e>string</span>) ($second <span style=color:#f92672>-</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>TAI_SECOND_EPOCH</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>and the game is done.</p><p>I mentioned nanoseconds and attoseconds above, but <a href=https://www.php.net/manual/en/datetime.format.php target=_blank rel=noopener><code>DateTimeInterface</code> only supports microseconds at most</a>, so we need to use
rounded values</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$nanosecond <span style=color:#f92672>=</span> <span style=color:#a6e22e>intval</span>(<span style=color:#a6e22e>hexdec</span>(<span style=color:#a6e22e>substr</span>($tai64NLabel, <span style=color:#ae81ff>16</span>)));
</span></span><span style=display:flex><span>$microsecond <span style=color:#f92672>=</span> <span style=color:#a6e22e>floatval</span>(<span style=color:#a6e22e>round</span>($nanosecond<span style=color:#f92672>/</span><span style=color:#ae81ff>1000</span>)<span style=color:#f92672>/</span><span style=color:#ae81ff>1000000</span>);
</span></span></code></pre></div><p>and also, since <a href=https://www.php.net/ChangeLog-8.php#8.1.7 target=_blank rel=noopener>PHP 8.1.7</a> solves <a href=https://github.com/php/php-src/issues/7758 target=_blank rel=noopener>a bug</a> with negative timestamps, we need to set that
version as minimum necessary.</p><p>Now let&rsquo;s briefly talk about <a href=https://en.wikipedia.org/wiki/Leap_second target=_blank rel=noopener>leap seconds</a>.</p><p>On the one hand, as already mentioned, we have TAI, very precise, but on the other hand we have the observed solar time <a href=https://en.wikipedia.org/wiki/Universal_Time target=_blank rel=noopener>UT1</a> that
varies due to irregularities and long-term slowdown in the Earth&rsquo;s rotation. The UTC time standard uses TAI and consequently would run ahead of observed solar time unless it is
reset to UT1 as needed. In order to accommodate the difference between these two standards, occasionally the so-called leap seconds are applied and since the Earth&rsquo;s rotational
speed varies in response to climatic and geological events, UTC leap seconds are irregularly spaced and unpredictable.</p><p>So even if <a href=https://www.theguardian.com/world/2022/nov/18/do-not-adjust-your-clock-scientists-call-time-on-the-leap-second target=_blank rel=noopener>leap seconds are going to be scrapped by 2035</a>
what we know is that the conversions work this way:</p><pre tabindex=0><code>UTC to TAI = UTC + leap seconds
TAI to UTC = TAI - leap seconds
</code></pre><p>That&rsquo;s why we can implement the conversion like this</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>LEAP_SECONDS</span> <span style=color:#f92672>=</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1972-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;10.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1972-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;11.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1973-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;12.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1974-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;13.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1975-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;14.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1976-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;15.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1977-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;16.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1978-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;17.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1979-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;18.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1980-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;19.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1981-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;20.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1982-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;21.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1983-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;22.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1985-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;23.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1988-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;24.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1990-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;25.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1991-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;26.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1992-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;27.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1993-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;28.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1994-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;29.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1996-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;30.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1997-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;31.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;1999-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;32.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;2006-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;33.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;2009-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;34.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;2012-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;35.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;2015-07-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;36.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;2017-01-01&#39;</span> <span style=color:#f92672>=&gt;</span> <span style=color:#e6db74>&#39;37.0&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#75715e>// the future leap seconds entries need to be added here
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>adjust</span>(<span style=color:#a6e22e>DateTimeInterface</span> $dateTimeInterface, <span style=color:#a6e22e>string</span> $adjustmentString) <span style=color:#f92672>:</span> <span style=color:#a6e22e>DateTimeInterface</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $leapSeconds <span style=color:#f92672>=</span> <span style=color:#a6e22e>self</span><span style=color:#f92672>::</span><span style=color:#a6e22e>LEAP_SECONDS</span>;
</span></span><span style=display:flex><span>    $leadSecondsApplicationStartingDate <span style=color:#f92672>=</span> <span style=color:#a6e22e>array_keys</span>($leapSeconds)[<span style=color:#ae81ff>0</span>];
</span></span><span style=display:flex><span>    $dateToAdjust <span style=color:#f92672>=</span> $dateTimeInterface<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d&#39;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ($dateToAdjust <span style=color:#f92672>&gt;=</span> $leadSecondsApplicationStartingDate) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>array_key_exists</span>($dateToAdjust, $leapSeconds)) {
</span></span><span style=display:flex><span>            $leapSeconds[$dateToAdjust] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;0&#39;</span>;
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>ksort</span>($leapSeconds);
</span></span><span style=display:flex><span>            $keys <span style=color:#f92672>=</span> <span style=color:#a6e22e>array_keys</span>($leapSeconds);
</span></span><span style=display:flex><span>            $key <span style=color:#f92672>=</span> (<span style=color:#a6e22e>array_search</span>($dateTimeInterface<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#e6db74>&#39;Y-m-d&#39;</span>), $keys, <span style=color:#66d9ef>true</span>) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>            $leapSecondsValue <span style=color:#f92672>=</span> $leapSeconds[$keys[$key]];
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            $leapSecondsValue <span style=color:#f92672>=</span> $leapSeconds[$dateToAdjust];
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        $seconds <span style=color:#f92672>=</span> <span style=color:#a6e22e>number_format</span>($leapSecondsValue, <span style=color:#ae81ff>0</span>, <span style=color:#e6db74>&#39;.&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>);
</span></span><span style=display:flex><span>        $modify <span style=color:#f92672>=</span> <span style=color:#a6e22e>sprintf</span>($adjustmentString, $seconds);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> $dateTimeInterface<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>modify</span>($modify);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $dateTimeInterface;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>There could be a lot more to say about, but after all this sermon, if you want to play a little with <a href=https://github.com/amaccis/datetai target=_blank rel=noopener>my library</a> and tell me how many bugs
you find, just install it and let me know!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>composer require amaccis/datetai
</span></span></code></pre></div></div><div class=tags><a href=https://amaccis.github.io/tags/english>English</a>
<a href=https://amaccis.github.io/tags/php>PHP</a></div></section></main><footer id=footer><div id=social><a class=symbol href=https://github.com/amaccis rel=me target=_blank><svg fill="#bbb" width="28" height="28" viewBox="0 0 72 72" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><title>Github</title><desc>Created with Sketch.</desc><defs/><g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="Social-Icons---Rounded-Black" transform="translate(-264.000000, -939.000000)"><g id="Github" transform="translate(264.000000, 939.000000)"><path d="M8 72H64c4.418278.0 8-3.581722 8-8V8c0-4.418278-3.581722-8-8-8H8c-4.418278 811624501e-24-8 3.581722-8 8V64c541083001e-24 4.418278 3.581722 8 8 8z" id="Rounded" fill="#bbb"/><path d="M35.9985 13C22.746 13 12 23.7870921 12 37.096644c0 10.6440272 6.876 19.6751861 16.4145 22.8617681C29.6145 60.1797862 30.0525 59.4358488 30.0525 58.7973276 30.0525 58.2250681 30.0315 56.7100863 30.0195 54.6996482c-6.6765 1.4562499-8.085-3.2302544-8.085-3.2302544-1.0905-2.7829884-2.664-3.5239139-2.664-3.5239139C17.091 46.4500754 19.4355 46.4801943 19.4355 46.4801943c2.4075.1701719 3.675 2.4833051 3.675 2.4833051 2.142 3.6820383 5.6175 2.6188404 6.9855 2.0014024C30.3135 49.4077535 30.9345 48.3460615 31.62 47.7436831 26.2905 47.1352808 20.688 45.0691228 20.688 35.8361671c0-2.6308879.9345-4.781379 2.4705-6.4665327C22.911 28.7597262 22.0875 26.3110578 23.3925 22.9934585c0 0 2.016-.6475568 6.6 2.4697516C31.908 24.9285993 33.96 24.6620468 36.0015 24.6515052 38.04 24.6620468 40.0935 24.9285993 42.0105 25.4632101c4.581-3.1173084 6.5925-2.4697516 6.5925-2.4697516C49.9125 26.3110578 49.089 28.7597262 48.8415 29.3696344 50.3805 31.0547881 51.309 33.2052792 51.309 35.8361671c0 9.2555448-5.6115 11.29309-10.9575 11.8894446.860999999999997.7439374 1.629 2.2137408 1.629 4.4621184C41.9805 55.4089489 41.9505 58.0067059 41.9505 58.7973276 41.9505 59.4418726 42.3825 60.1918338 43.6005 59.9554002 53.13 56.7627944 60 47.7376593 60 37.096644 60 23.7870921 49.254 13 35.9985 13" fill="#fff"/></g></g></g></svg></a><a class=symbol href=https://www.linkedin.com/in/amaccis/ rel=me target=_blank><svg width="28" height="28" fill="#bbb" viewBox="0 0 500 500"><g fill="none" fill-rule="evenodd"><rect width="500" height="500" fill="#bbb" rx="50"/><path fill="#fff" d="M154.703 100.183c-19.121.0-34.689 15.565-34.703 34.701.0 19.136 15.568 34.704 34.703 34.704 19.128.0 34.688-15.568 34.688-34.704.0-19.134-15.561-34.701-34.688-34.701zm26.045 83.348h-52.094a4.488 4.488.0 00-4.488 4.489v167.675a4.488 4.488.0 004.488 4.488h52.093a4.49 4.49.0 004.489-4.488V188.02a4.486 4.486.0 00-4.488-4.489zm133.176-1.974c-19.064.0-35.817 5.805-46.04 15.271v-8.808c0-2.48-2.01-4.489-4.489-4.489h-49.971a4.489 4.489.0 00-4.489 4.489v167.675a4.488 4.488.0 004.489 4.488h52.044a4.49 4.49.0 004.489-4.488v-82.957c0-23.802 4.378-38.555 26.227-38.555 21.526.026 23.137 15.846 23.137 39.977v81.535a4.489 4.489.0 004.49 4.488h52.068a4.489 4.489.0 004.488-4.488v-91.977c-.001-38.253-7.553-82.161-66.443-82.161z"/></g></svg></a><a class=symbol href=https://x.com/andreamaccis rel=me target=_blank><svg fill="#bbb" width="28" height="28" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="438.536" height="438.536" viewBox="0 0 438.536 438.536" style="enable-background:new 0 0 438.536 438.536"><g><path d="M414.41 24.123C398.333 8.042 378.963.0 356.315.0H82.228C59.58.0 40.21 8.042 24.126 24.123 8.045 40.207.003 59.576.003 82.225v274.084c0 22.647 8.042 42.018 24.123 58.102 16.084 16.084 35.454 24.126 58.102 24.126h274.084c22.648.0 42.018-8.042 58.095-24.126 16.084-16.084 24.126-35.454 24.126-58.102V82.225C438.532 59.576 430.49 40.204 414.41 24.123zM335.471 168.735c.191 1.713.288 4.278.288 7.71.0 15.989-2.334 32.025-6.995 48.104-4.661 16.087-11.8 31.504-21.416 46.254-9.606 14.749-21.074 27.791-34.396 39.115-13.325 11.32-29.311 20.365-47.968 27.117-18.648 6.762-38.637 10.143-59.953 10.143-33.116.0-63.76-8.952-91.931-26.836 4.568.568 9.329.855 14.275.855 27.6.0 52.439-8.565 74.519-25.7-12.941-.185-24.506-4.179-34.688-11.991-10.185-7.803-17.273-17.699-21.271-29.691 4.947.76 8.658 1.137 11.132 1.137 4.187.0 9.042-.76 14.56-2.279-13.894-2.669-25.598-9.562-35.115-20.697-9.519-11.136-14.277-23.84-14.277-38.114v-.571c10.085 4.755 19.602 7.229 28.549 7.422-17.321-11.613-25.981-28.265-25.981-49.963.0-10.66 2.758-20.747 8.278-30.264 15.035 18.464 33.311 33.213 54.816 44.252 21.507 11.038 44.54 17.227 69.092 18.558-.95-3.616-1.427-8.186-1.427-13.704.0-16.562 5.853-30.692 17.56-42.399 11.703-11.706 25.837-17.561 42.394-17.561 17.515.0 32.079 6.283 43.688 18.846 13.134-2.474 25.892-7.33 38.26-14.56-4.757 14.652-13.613 25.788-26.55 33.402 12.368-1.716 23.88-4.95 34.537-9.708C357.458 149.793 347.462 160.166 335.471 168.735z"/></g></svg></a></div><div class=copyright>© Copyright 2023 - Andrea Maccis</div><div class=powerby>Powered by <a href=http://www.gohugo.io/>Hugo</a> Theme By <a href=https://github.com/nodejh/hugo-theme-mini>nodejh</a></div></footer></body></html>